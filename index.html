<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpecCom | Field Verification</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div>
          <div class="brand-title">SpecCom</div>
          <div class="muted small" data-i18n="brandSubtitle">Field verification, documentation, and billing control</div>
        </div>
      </div>
      <div class="row topbar-actions">
        <button id="btnMessages" class="topbar-btn" type="button" data-i18n="messagesNav">Messages
          <span id="messagesBadge" class="alert-badge" style="display:none;">0</span>
        </button>
        <button id="btnProjects" class="topbar-btn" type="button" data-i18n="projectsNav">Projects</button>
        <button id="btnMapToggle" class="topbar-btn" type="button" data-i18n="mapToggle" aria-pressed="true">Map</button>
        <button id="btnMenu" class="icon-btn" type="button" aria-label="Places">
          <span class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      </div>
    </div>
  </header>
  <div class="page container">
    <div class="spacer"></div>
    <div id="envWarning" class="note" style="display:none;"></div>
    <div id="storageWarning" class="note" style="display:none;"></div>

    <div id="viewAuth" class="stack">
      <div class="auth-wrap">
        <div class="card auth-card">
          <h1 data-i18n="authTitle">Sign in to SpecCom</h1>

          <div class="hr"></div>

          <form id="authForm" autocomplete="on">
            <div class="field-stack">
              <input id="email" class="input" placeholder="email" data-i18n-placeholder="emailPlaceholder" autocomplete="username" />
              <input id="password" class="input" placeholder="password" type="password" data-i18n-placeholder="passwordPlaceholder" autocomplete="current-password" />
            </div>
            <div class="row" style="margin-top:12px;">
              <button id="btnSignIn" class="btn" data-action="signIn" data-i18n="signIn" type="button">Sign in</button>
              <button id="btnSignUp" class="btn secondary" data-action="signUp" data-i18n="createUser" type="button">Create account</button>
              <button id="btnDemoLogin" class="btn ghost" data-action="demoLogin" data-i18n="demoLogin" type="button" style="display:none;">Demo login</button>
            </div>
            <div class="row" style="margin-top:8px;">
              <button id="btnForgotPassword" class="btn ghost small" type="button">Forgot password?</button>
            </div>
          </form>
          <form id="resetForm" autocomplete="on" style="display:none;">
            <div class="field-stack">
              <input id="resetPassword" class="input" placeholder="New password" type="password" autocomplete="new-password" />
              <input id="resetPasswordConfirm" class="input" placeholder="Confirm password" type="password" autocomplete="new-password" />
            </div>
            <div class="row" style="margin-top:12px;">
              <button id="btnResetPassword" class="btn" type="button">Reset password</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="viewApp" class="app-shell" style="display:none;">
      <aside id="leftControlRail" class="sidebar gis-sidebar">
        <aside id="rightDrawer" class="right-drawer gis-drawer">
          <div class="wired-sidebar-top">
            <div class="wired-logo-lockup">
              <span class="wired-logo-mark" aria-hidden="true"></span>
              <span class="wired-logo-text">Wired</span>
            </div>
            <button id="mapProjectLabel" class="wired-project-pill" type="button">Select project</button>
          </div>
          <div class="sidebar-header gis-header">
            <div class="sidebar-title">Places</div>
            <div class="sidebar-header-actions">
              <button id="btnImportLocations" class="btn ghost small" type="button">Import KMZ / ZIP</button>
              <input id="importLocationsInput" type="file" accept=".kmz,.zip,application/vnd.google-earth.kmz,application/zip" style="display:none;" />
            </div>
          </div>
          <div class="sidebar-tabs gis-tabs">
            <button class="btn ghost small is-active" type="button" data-sidebar-tab="data">Data</button>
            <button class="btn ghost small" type="button" data-sidebar-tab="legend">Legend</button>
          </div>
          <div class="sidebar-body gis-body">
            <section id="sidebarTabData" class="sidebar-tab active">
              <div class="map-layer-card gis-panel">
                <label class="muted small" for="kmzTreeSearch">Search network points</label>
                <input
                  id="kmzTreeSearch"
                  class="input compact"
                  type="text"
                  placeholder="Search network points..."
                  aria-label="Search network points"
                />
                <div id="kmzFolderTree" class="kmz-tree" style="margin-top:10px;"></div>
              </div>
            </section>
            <section id="sidebarTabLegend" class="sidebar-tab">
              <div id="kmzLegendBody" class="map-layer-card gis-panel"></div>
            </section>
          </div>
        </aside>
      </aside>

      <main class="content">
        <section id="viewDashboard" class="view">
          <div class="card job-card">
            <div class="row" style="justify-content:space-between;">
              <div>
                <h2 id="jobTitle">Job 731022136</h2>
                <div id="jobSubtitle" class="muted small" data-i18n="jobSubtitle">Ruidoso FTTH Rebuild (site-by-site workflow)</div>
              </div>
              <div class="no-pay-badge" data-i18n="photosOptionalBadge">Photos optional for MVP</div>
            </div>
            <div id="nodeCards" class="node-grid" style="margin-top:12px;"></div>
          </div>
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="activeNodeTitle">Active site</h2>
              <div class="kpi">
                <div class="tile">
                  <div class="label" data-i18n="kpiNode">Site</div>
                  <div id="dashNode" class="value">None</div>
                </div>
                <div class="tile">
                  <div class="label" data-i18n="kpiCompletion">Completion</div>
                  <div id="dashCompletion" class="value">0%</div>
                </div>
                <div class="tile">
                  <div class="label" data-i18n="kpiUnits">Units</div>
                  <div id="dashUnits" class="value">0 / 0</div>
                </div>
              </div>
              <div style="margin-top:14px;" class="row">
                <span id="chipStatus" class="chip"><span class="dot warn"></span><span>Waiting</span></span>
                <span id="chipRole" class="chip"><span class="dot ok"></span><span>Role: ?</span></span>
                <span id="chipPricing" class="chip"><span class="dot bad"></span><span data-i18n="pricingHidden">Pricing hidden from splicers</span></span>
                <span id="chipBuildMode" class="chip" style="display:none;"><span class="dot warn"></span><span>BUILD MODE (restrictions disabled)</span></span>
              </div>
              <div class="hr"></div>
              <div id="photoChecklistSummary" class="note"></div>
            </div>
            <div class="card">
              <h2 data-i18n="alertsTitle">Alerts</h2>
              <div id="alertsFeed"></div>
            </div>
          </div>
          <div class="grid cols-2" style="margin-top:16px;">
            <div class="card">
              <h2 data-i18n="allowedQuantitiesTitle">Allowed quantities</h2>
              <div id="allowedQuantities"></div>
            </div>
            <div class="card">
              <h2 data-i18n="catalogQuickSearchTitle">Catalog quick search</h2>
              <input id="catalogSearchQuick" class="input" placeholder="Search Millennium part, MFG SKU, description" data-i18n-placeholder="catalogSearchPlaceholder" />
              <div id="catalogResultsQuick" class="catalog-list" style="margin-top:12px;"></div>
            </div>
          </div>
        </section>

        <section id="viewTechnician" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="techClockTitle">Time tracking</h2>
              <div id="techClockStatus" class="muted small" style="margin-top:6px;"></div>
              <div class="row" style="margin-top:12px;">
                <button id="btnTechClockIn" class="btn" data-action="techClockIn" data-i18n="techClockIn">Clock In</button>
                <button id="btnTechClockOut" class="btn secondary" data-action="techClockOut" data-i18n="techClockOut">Clock Out</button>
              </div>
              <div class="hr"></div>
              <div class="muted small" data-i18n="techJobStateLabel">Current state</div>
              <div id="techJobState" class="chip" style="margin-top:8px;"></div>
              <div class="row" style="flex-wrap:wrap; margin-top:12px;">
                <button id="btnTechStartJob" class="btn" data-action="techStartJob" data-i18n="techStartJob">Start Job</button>
                <button id="btnTechPauseJob" class="btn secondary" data-action="techPauseJob" data-i18n="techPauseJob">Pause Job</button>
                <button id="btnTechLunch" class="btn ghost" data-action="techLunch" data-i18n="techLunch">Lunch</button>
                <button id="btnTechBreak" class="btn ghost" data-action="techBreak" data-i18n="techBreak">Break</button>
                <button id="btnTechTruckInspection" class="btn ghost" data-action="techTruckInspection" data-i18n="techTruckInspection">Truck Inspection</button>
                <button id="btnTechEndJob" class="btn danger" data-action="techEndJob" data-i18n="techEndJob">End Job</button>
              </div>
              <div class="hr"></div>
              <div id="techEventLog" class="tech-log"></div>
            </div>
            <div class="card">
              <h2 data-i18n="techSummaryTitle">Daily summary</h2>
              <div id="techSummary" style="margin-top:12px;"></div>
              <div class="hr"></div>
              <h3 data-i18n="techLocationTrailTitle">Location trail</h3>
              <div id="techLocationTrail" class="muted small" style="margin-top:8px;"></div>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="techWorkOrdersTitle">Work orders</h2>
              <div class="muted small" data-i18n="techWorkOrdersSubtitle">Assigned installs and trouble tickets</div>
            </div>
            <div class="grid cols-2" style="margin-top:12px;">
              <div>
                <h3 data-i18n="techTodayTitle">Today</h3>
                <div id="techWorkOrdersToday" style="margin-top:10px;"></div>
              </div>
              <div>
                <h3 data-i18n="techTomorrowTitle">Tomorrow</h3>
                <div id="techWorkOrdersTomorrow" style="margin-top:10px;"></div>
              </div>
            </div>
          </div>
        </section>

        <section id="viewNodes" class="view">
          <div class="card">
            <h1 data-i18n="nodesTitle">Site workspace</h1>
            <div class="muted small" data-i18n="nodesSubtitle">Only one ACTIVE site at a time. Finish splicing before moving to the next site.</div>

            <div class="row" style="margin-bottom:12px;">
              <input id="nodeNumber" class="input" placeholder="Enter site number (example: SITE-1001)" data-i18n-placeholder="nodeNumberPlaceholder" />
              <button id="btnOpenNode" class="btn" data-action="openNodeInput" data-i18n="openNode">Open site</button>
              <button id="btnNewNode" class="btn secondary" data-action="createNodeInput" data-i18n="createNode">Create site</button>
            </div>

            <div class="hr"></div>

            <h2 data-i18n="spliceLocationsTitle">Splice locations</h2>
            <p class="muted small" data-i18n="spliceLocationsSubtitle">Photos are optional for billing in this MVP.</p>

            <div class="row">
              <button id="btnAddLocation" class="btn secondary" data-action="addSpliceLocation" data-i18n="addSpliceLocation">Add splice location</button>
            </div>

            <div id="locations" style="margin-top:12px;"></div>

            <div class="hr"></div>

            <h2 data-i18n="inventoryTitle">Inventory checklist</h2>
            <p class="muted small" data-i18n="inventorySubtitle">What was used at this site. Splicers see items and checklists, not pricing.</p>
            <div id="inventory" style="margin-top:12px;"></div>
          </div>
        </section>



        <section id="viewPhotos" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="photoChecklistTitle">Photo checklist</h2>
              <div class="no-pay-banner" data-i18n="photosOptionalBanner">Photos optional for MVP</div>
              <div id="photoChecklist"></div>
            </div>
            <div class="card">
              <h2 data-i18n="capturePhotosTitle">Capture photos</h2>
              <div class="muted small" data-i18n="capturePhotosSubtitle">Camera-only. GPS required at capture time. No gallery uploads.</div>
              <div class="camera-panel">
                <video id="cameraStream" autoplay playsinline muted></video>
              </div>
              <div class="row" style="margin-top:12px;">
                <button id="btnStartCamera" class="btn secondary" data-action="startCamera" data-i18n="startCamera">Start camera</button>
                <button id="btnCapturePhoto" class="btn secondary" data-action="captureUsagePhoto" data-i18n="captureUsagePhoto">Capture usage photo</button>
              </div>
              <div id="photoStatus" class="muted small" style="margin-top:10px;" data-i18n="photoStatusNone">No photo captured</div>
              <div id="photoPreview" class="photo-preview" style="margin-top:12px;"></div>
              <div class="hr"></div>
              <div id="backfillPanel" class="note backfill-panel" style="display:none;">
                <div style="font-weight:900;">Owner backfill</div>
                <div class="muted small">Upload from device when backfill is enabled for this site.</div>
                <div class="row" style="flex-wrap:wrap; margin-top:8px;">
                  <select id="backfillLocationSelect" class="input" style="min-width:220px; flex:1 1 auto;"></select>
                </div>
                <div class="row" style="flex-wrap:wrap; margin-top:8px;">
                  <label class="btn ghost file-btn">
                    Upload from device (Port test)
                    <input id="backfillPortInput" type="file" accept="image/*" />
                  </label>
                  <label class="btn ghost file-btn">
                    Upload from device (Splice complete)
                    <input id="backfillSpliceInput" type="file" accept="image/*" />
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section id="viewInvoices" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="invoiceActionsTitle">Invoice actions</h2>
              <div class="no-pay-banner" data-i18n="invoicesUngatedBanner">Invoices available without proof in MVP</div>
              <div class="muted small" data-i18n="invoiceActionsSubtitle">Billing entry is available in this MVP.</div>
              <div class="row" style="margin-top:12px;">
                <button id="btnMarkNodeReady" class="btn" data-action="markNodeReady" data-i18n="markNodeReady">Mark site READY for billing</button>
                <button id="btnCreateInvoice" class="btn secondary" data-action="createInvoice" data-i18n="createInvoice">Create invoice (role-based)</button>
              </div>
              <div id="readyNote" class="note" style="margin-top:12px; display:none;"></div>
            </div>
            <div class="card">
              <h2 data-i18n="invoicesPrivacyTitle">Invoices and privacy</h2>
              <div class="muted small">
                This panel shows what <b>you</b> can see based on your role.
                In Supabase, RLS policies enforce this server-side.
              </div>

              <div class="hr"></div>
              <div id="invoicePanel"></div>
            </div>
          </div>
        </section>

        <section id="viewBilling" class="view">
          <div class="grid cols-2">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2 data-i18n="billingLocationsTitle">Locations</h2>
                <span id="billingStatus" class="muted small"></span>
              </div>
              <div id="billingLocationList" class="location-list" style="margin-top:12px;"></div>
            </div>
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2 data-i18n="billingTitle">Billing</h2>
                <div class="row">
                  <button id="btnImportUsage" class="btn ghost" data-action="importUsage" data-i18n="importUsage">Import usage</button>
                  <button id="btnBillingExportCsv" class="btn ghost" data-action="billingExportCsv" data-i18n="exportCsv">Export CSV</button>
                  <button id="btnBillingPrint" class="btn ghost" data-action="billingPrint" data-i18n="print">Print</button>
                </div>
              </div>
              <div id="billingDetail" class="muted small" style="margin-top:12px;" data-i18n="billingSelectLocation">Select a location to start billing.</div>
            </div>
          </div>
        </section>

        <section id="viewDispatch" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between; align-items:center;">
              <h2 data-i18n="dispatchTitle">Dispatch</h2>
              <div class="row" style="flex-wrap:wrap;">
                <button id="btnDispatchCreate" class="btn" data-action="dispatchCreate" data-i18n="dispatchCreate">Create work order</button>
                <button id="btnDispatchImportCsv" class="btn ghost" data-action="dispatchImportCsv" data-i18n="dispatchImportCsv">Import CSV</button>
                <input id="dispatchCsvInput" type="file" accept=".csv,text/csv" style="display:none;" />
              </div>
            </div>
            <div class="row" style="flex-wrap:wrap; margin-top:12px;">
              <input id="dispatchDateFilter" class="input" type="date" />
              <select id="dispatchStatusFilter" class="input">
                <option value="" data-i18n="dispatchStatusAll">All statuses</option>
              </select>
              <select id="dispatchAssignFilter" class="input">
                <option value="all" data-i18n="dispatchAssignAll">All</option>
                <option value="assigned" data-i18n="dispatchAssignAssigned">Assigned</option>
                <option value="unassigned" data-i18n="dispatchAssignUnassigned">Unassigned</option>
              </select>
            </div>
            <div id="dispatchImportWarnings" class="note warning" style="display:none; margin-top:12px;"></div>
            <div id="dispatchTable" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewLabor" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="laborTitle">Labor</h2>
              <button id="btnLaborExportCsv" class="btn ghost" data-action="laborExportCsv" data-i18n="exportCsv">Export CSV</button>
            </div>
            <div id="laborTable" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewMap" class="view active">
          <div id="mapWorkspace" class="map-workspace">
            <button id="mapSidebarToggle" class="map-menu-btn" type="button" aria-label="Toggle Places" aria-expanded="true">
              <span class="hamburger">
                <span></span>
                <span></span>
                <span></span>
              </span>
            </button>
            <main id="mapCanvas" class="map-canvas">
              <div id="mapBasemapSwitch" class="map-basemap-switch" role="group" aria-label="Basemap">
                <button type="button" class="map-basemap-chip is-active" data-map-basemap-quick="street">Map</button>
                <button type="button" class="map-basemap-chip" data-map-basemap-quick="satellite">Satellite</button>
              </div>
              <div id="mapViewFloating" class="map-view-floating">
                <div class="site-panel-title">Layers</div>
                <div id="mapViewDropdown" class="map-view-dropdown">
                  <button
                    id="mapViewDropdownButton"
                    type="button"
                    class="map-view-trigger input"
                    aria-expanded="false"
                    aria-controls="mapViewDropdownMenu"
                  >
                    <span id="mapViewDropdownLabel">Street</span>
                    <span class="map-view-trigger-caret" aria-hidden="true"></span>
                  </button>
                  <div id="mapViewDropdownMenu" class="map-view-menu" hidden>
                    <div class="map-view-menu-section">
                      <div class="muted small map-view-menu-title">Basemap</div>
                      <label class="map-view-option-row">
                        <input type="radio" name="mapViewBasemap" value="street" data-map-basemap />
                        <span>Street</span>
                      </label>
                      <label class="map-view-option-row">
                        <input type="radio" name="mapViewBasemap" value="satellite" data-map-basemap />
                        <span>Satellite</span>
                      </label>
                    </div>
                    <div class="map-view-menu-divider" role="separator"></div>
                    <div class="map-view-menu-section">
                      <div class="muted small map-view-menu-title">Overlays</div>
                      <div id="mapViewOverlayList" class="map-view-overlay-list"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div id="liveMap" class="map-leaflet map"></div>
            </main>
            <aside id="mapDetailsDrawer" class="map-details-drawer">
              <div class="map-details-header">
                <div id="mapDetailsTitle" class="site-panel-title">Feature details</div>
                <button id="btnMapDetailsClose" class="btn ghost small" type="button">Close</button>
              </div>
              <div id="mapDetailsBody" class="map-details-body">
                <div class="muted small">Select a feature and click View Details.</div>
              </div>
            </aside>
          </div>
        </section>

        <section id="viewCatalog" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="catalogTitle">Material catalog</h2>
              <button id="btnCatalogClear" class="btn ghost" data-action="catalogClear" data-i18n="clear">Clear</button>
            </div>
            <div class="row" style="margin-top:12px;">
              <input id="catalogSearch" class="input" placeholder="Search Millennium part, MFG SKU, description" data-i18n-placeholder="catalogSearchPlaceholder" />
            </div>
            <div id="catalogResults" class="catalog-list" style="margin-top:16px;"></div>
          </div>
        </section>

        <section id="viewAlerts" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="alertsFeedTitle">Alerts feed</h2>
              <span id="alertsBadge" class="badge">No alerts</span>
            </div>
            <div id="alertsFeedFull" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewAdmin" class="view">
          <div class="card">
            <h2 data-i18n="adminNotesTitle">Admin notes</h2>
            <div class="note">
              <div style="font-weight:900;">Next build steps</div>
              <ol class="muted small" style="margin-top:8px;">
                <li>Wire Supabase keys in Netlify env vars.</li>
                <li>Run the SQL schema + RLS in Supabase.</li>
                <li>Enable Storage bucket for photos (private).</li>
                <li>Add real site sheets import and Millennium part lookup.</li>
              </ol>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <h2 data-i18n="userManagementTitle">User management</h2>
            <div class="muted small" data-i18n="userManagementSubtitle">Create/update profile rows for authenticated users. Auth users must already exist in Supabase.</div>
            <div id="adminBuildGate" class="note warning" style="display:none; margin-top:10px;">
              <div style="font-weight:900;">Build mode disabled</div>
              <div class="muted small">Enable BUILD_MODE to manage user profiles.</div>
            </div>
            <div id="adminUsersPanel" style="margin-top:12px;">
              <div class="row" style="flex-wrap:wrap;">
                <input id="adminUserId" class="input" placeholder="Auth user id (UUID)" data-i18n-placeholder="adminUserIdPlaceholder" />
                <input id="adminUserEmail" class="input" placeholder="Email or display name" data-i18n-placeholder="adminUserEmailPlaceholder" />
                <select id="adminUserRole" class="input" style="min-width:180px;">
                  <option value="OWNER">Owner</option>
                  <option value="ADMIN">Admin</option>
                  <option value="PROJECT_MANAGER">Project Manager</option>
                  <option value="USER_LEVEL_1">User Level 1</option>
                  <option value="USER_LEVEL_2">User Level 2</option>
                  <option value="SUPPORT">Support</option>
                </select>
                <button id="btnAdminCreateUser" class="btn secondary" data-action="adminCreateUser" data-i18n="createProfile">Create profile</button>
              </div>
              <div class="hr"></div>
              <div id="adminUsersList"></div>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <h2>Inventory + SMS Alerts</h2>
            <div class="muted small">ADMIN/ROOT only. Keep on-hand and reorder points current, and configure SMS alert delivery.</div>
            <div id="adminMaterialGate" class="note warning" style="display:none; margin-top:10px;">
              <div style="font-weight:900;">Admin access required</div>
              <div class="muted small">Only ADMIN/ROOT can edit inventory stock and SMS subscriptions.</div>
            </div>
            <div id="adminMaterialPanel" style="margin-top:12px;">
              <div class="row" style="flex-wrap:wrap; align-items:flex-end;">
                <div class="field-stack" style="min-width:220px; flex:1 1 220px;">
                  <label class="muted small" for="adminSmsPhone">Patrick SMS (E.164)</label>
                  <input id="adminSmsPhone" class="input" placeholder="+1575xxxxxxx" />
                </div>
                <div class="field-stack" style="min-width:140px;">
                  <label class="muted small" for="adminSmsCooldown">Cooldown (minutes)</label>
                  <input id="adminSmsCooldown" class="input" type="number" min="1" step="1" value="30" />
                </div>
                <label class="row" style="gap:8px; min-width:120px; align-items:center; margin-bottom:8px;">
                  <input id="adminSmsEnabled" type="checkbox" />
                  <span>SMS enabled</span>
                </label>
                <button id="btnAdminSmsSave" class="btn secondary" type="button">Save SMS</button>
              </div>
              <div id="adminInventoryStatus" class="muted small" style="margin-top:10px;"></div>
              <div id="adminInventoryTable" style="margin-top:10px;"></div>
              <div class="row" style="margin-top:10px;">
                <button id="btnAdminInventoryRefresh" class="btn ghost" type="button">Refresh</button>
                <button id="btnAdminInventorySave" class="btn secondary" type="button">Save Inventory</button>
              </div>
            </div>
          </div>
        </section>

        <section id="viewSettings" class="view">
          <div class="card">
            <h1 data-i18n="settingsTitle">Settings</h1>
            <div class="field-stack">
              <label class="muted small" data-i18n="languageLabel">Language</label>
              <select id="languageSelect" class="input">
                <option value="en" data-i18n="languageOptionEnglish">English</option>
                <option value="es" data-i18n="languageOptionSpanish">Spanish</option>
                <option value="pt" data-i18n="languageOptionPortuguese">Portuguese</option>
              </select>
              <div class="muted small" data-i18n="languageHelp">Changes apply immediately and sync to your profile.</div>
              <div class="row">
                <button id="btnSaveLanguage" class="btn secondary" data-action="saveLanguage" data-i18n="saveLanguage">Save language</button>
              </div>
            </div>
          </div>
        </section>
        <section id="viewDailyReport" class="view">
          <div class="card">
            <h1 data-i18n="dailyReportTitle">Daily Report</h1>
            <div class="field-stack">
              <label class="muted small" data-i18n="dprProjectLabel">Project</label>
              <select id="dprProjectSelect" class="input">
                <option value="" data-i18n="selectProject">Select project</option>
              </select>
              <label class="muted small" data-i18n="dprDateLabel">Report date</label>
              <input id="dprDate" class="input" type="date" />
              <div class="row">
                <button id="btnDprRefresh" class="btn secondary" type="button" data-i18n="dprRefresh">Generate / Refresh</button>
              </div>
              <div id="dprMetrics" class="dpr-metrics"></div>
              <label class="muted small" data-i18n="dprCommentsLabel">Comments / Needs Addressed</label>
              <textarea id="dprComments" class="input" rows="4" data-i18n-placeholder="dprCommentsPlaceholder" placeholder="Anything needs addressed?"></textarea>
              <div class="row">
                <button id="btnDprSave" class="btn" type="button" data-i18n="saveLabel">Save</button>
              </div>
              <div id="dprNote" class="muted small"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="profileSetupModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Choose Language / Elegir idioma</h2>
        <div class="muted small">Select your preferred language to continue.</div>
        <div class="field-stack" style="margin-top:12px;">
          <select id="profileLanguageSelect" class="input">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="pt">Português</option>
          </select>
          <button id="btnSaveProfileLanguage" class="btn" data-action="saveProfileLanguage">Save / Guardar</button>
        </div>
      </div>
    </div>

    <div id="createProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Create project</h2>
        <form id="createProjectForm" autocomplete="off">
          <div class="field-stack" style="margin-top:12px;">
            <input id="createProjectName" name="project_name" class="input" placeholder="Project name" autocomplete="off" />
            <textarea id="createProjectDescription" name="project_description" class="input" rows="3" placeholder="Description (optional)" autocomplete="off"></textarea>
          </div>
          <div class="row" style="margin-top:12px; justify-content:flex-end;">
            <button id="btnCreateProjectCancel" class="btn ghost" type="button">Cancel</button>
            <button id="btnCreateProjectSave" class="btn" type="button">Create</button>
          </div>
        </form>
      </div>
    </div>

    <div id="deleteProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Delete project</h2>
        <div class="muted small">Type DELETE to confirm. This permanently removes project data.</div>
        <div class="field-stack" style="margin-top:12px;">
          <input id="deleteProjectConfirm" class="input" placeholder="Type DELETE to confirm" autocomplete="off" />
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnDeleteProjectCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnDeleteProjectConfirm" class="btn danger" type="button">Delete project</button>
        </div>
      </div>
    </div>

    <div id="projectsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="projectsNav">Projects</h2>
          <button id="btnProjectsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="projectsList" class="project-list" style="margin-top:10px;"></div>
        <div id="projectsEmpty" class="empty-state" style="display:none; margin-top:10px;">
          <div class="empty-state-title" data-i18n="projectsEmptyTitle">No projects yet</div>
          <div class="empty-state-body muted small" data-i18n="projectsEmptyBody">Create a project to start tracking sites and documentation, or ask your admin to add you to an existing project.</div>
          <div class="row" style="margin-top:12px; justify-content:flex-end;">
            <button id="btnProjectsEmptyCreate" class="btn" type="button" data-i18n="projectsEmptyCta">Create project</button>
          </div>
        </div>
        <div id="projectsFooter" class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnProjectsCreate" class="btn" type="button" data-i18n="createProject">Create project</button>
        </div>
      </div>
    </div>

    <div id="messagesModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="messagesNav">Messages</h2>
          <button id="btnMessagesClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="messagesScope" class="muted small" style="margin-top:4px;"></div>
        <div class="segmented" style="margin-top:10px;">
          <button id="btnMessagesFilterBoard" class="segmented-btn active" type="button" data-filter="board">Main Board</button>
          <button id="btnMessagesFilterDirect" class="segmented-btn" type="button" data-filter="direct">Direct Messages</button>
        </div>
        <div id="messagesList" class="messages-list" style="margin-top:10px;"></div>
        <div id="messagesEmpty" class="muted small" style="margin-top:10px; display:none;" data-i18n="messagesEmpty">No messages yet.</div>
        <div class="field-stack" style="margin-top:12px;">
          <div class="row" style="gap:8px; flex-wrap:wrap;">
            <select id="messageMode" class="input" style="min-width:190px; flex:1 1 220px;">
              <option value="board">Main Board</option>
              <option value="direct">Direct Messages</option>
            </select>
            <select id="messageRecipient" class="input" style="min-width:220px; flex:1 1 220px; display:none;">
              <option value="">Select recipient</option>
            </select>
          </div>
          <textarea id="messageInput" class="input" rows="3" data-i18n-placeholder="messagePlaceholder" placeholder="Write a message..."></textarea>
          <div class="row" style="justify-content:flex-end;">
            <button id="btnSendMessage" class="btn" type="button" data-i18n="sendMessage">Send</button>
          </div>
        </div>
      </div>
    </div>

    <div id="dispatchModal" class="modal" style="display:none;">
      <div class="card modal-card" style="max-width:720px;">
        <h2 data-i18n="dispatchModalTitle">Work order</h2>
        <div class="field-stack" style="margin-top:12px;">
          <select id="dispatchType" class="input">
            <option value="INSTALL">INSTALL</option>
            <option value="TROUBLE_TICKET">TROUBLE_TICKET</option>
            <option value="MAINTENANCE">MAINTENANCE</option>
            <option value="SURVEY">SURVEY</option>
          </select>
          <select id="dispatchStatus" class="input">
            <option value="NEW">NEW</option>
            <option value="ASSIGNED">ASSIGNED</option>
            <option value="EN_ROUTE">EN_ROUTE</option>
            <option value="ON_SITE">ON_SITE</option>
            <option value="IN_PROGRESS">IN_PROGRESS</option>
            <option value="BLOCKED">BLOCKED</option>
            <option value="COMPLETE">COMPLETE</option>
            <option value="CANCELED">CANCELED</option>
          </select>
          <input id="dispatchScheduledStart" class="input" type="datetime-local" />
          <input id="dispatchScheduledEnd" class="input" type="datetime-local" />
          <input id="dispatchCustomerLabel" class="input" placeholder="Customer name" />
          <input id="dispatchAddress" class="input" placeholder="Address" />
          <div class="row">
            <input id="dispatchLat" class="input" placeholder="Lat" />
            <input id="dispatchLng" class="input" placeholder="Lng" />
          </div>
          <input id="dispatchContactPhone" class="input" placeholder="Contact phone" />
          <input id="dispatchPriority" class="input" type="number" min="1" max="5" placeholder="Priority (1-5)" />
          <input id="dispatchSlaDueAt" class="input" type="datetime-local" />
          <textarea id="dispatchNotes" class="input" rows="3" placeholder="Notes"></textarea>
          <select id="dispatchAssignUser" class="input">
            <option value="">Unassigned</option>
          </select>
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnDispatchCancel" class="btn ghost" data-action="dispatchCancel" data-i18n="cancelLabel">Cancel</button>
          <button id="btnDispatchSave" class="btn" data-action="dispatchSave" data-i18n="saveLabel">Save</button>
        </div>
      </div>
    </div>

    <div id="importLocationsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import locations</h2>
          <button id="btnImportLocationsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="importLocationsSummary" class="muted small" style="margin-top:6px;"></div>
        <div class="row" style="margin-top:10px; justify-content:space-between; align-items:center;">
          <div class="muted small">Use template headers for best results (locations + notes + codes + photo URLs).</div>
          <div class="row" style="gap:8px;">
            <button id="btnImportLocationsErrors" class="btn ghost small" type="button">Download Error Report</button>
            <button id="btnImportLocationsTemplate" class="btn ghost small" type="button">Download Template</button>
          </div>
        </div>
        <div id="importLocationsList" class="field-stack" style="margin-top:10px; max-height:240px; overflow:auto;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnImportLocationsCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnImportLocationsConfirm" class="btn" type="button">Confirm Import</button>
        </div>
      </div>
    </div>

    <div id="priceSheetModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import Price Sheet</h2>
          <button id="btnPriceSheetClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="priceSheetInput" type="file" accept=".csv,.xlsx,.pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,application/pdf" />
          <div class="muted small">Expected headers: code, description, unit, rate</div>
          <div class="muted small">USER2 = USER1 +25% • OWNER = USER2 +25%</div>
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnPriceSheetCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnPriceSheetConfirm" class="btn" type="button">Import Pricing</button>
        </div>
      </div>
    </div>

    <div id="stakingProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Create Project from Staking PDF</h2>
          <button id="btnStakingProjectClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="stakingProjectInput" type="file" accept=".pdf,application/pdf" />
          <div class="muted small">Uploads a staking package PDF and builds a project + placeholder sites.</div>
          <div class="hr" style="margin:8px 0;"></div>
          <input id="stakingLocationsInput" type="file" accept=".csv,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" />
          <div class="muted small">Optional: upload a location spreadsheet to set accurate GPS and merge by location name.</div>
        </div>
        <div id="stakingProjectSummary" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnStakingProjectCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnStakingProjectConfirm" class="btn" type="button">Create Project</button>
        </div>
      </div>
    </div>

    <div id="testResultsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import Test Results (ZIP)</h2>
          <button id="btnTestResultsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="testResultsInput" type="file" accept=".zip,application/zip" />
          <div class="muted small">Reads screenshot text to match GPS/location and attach photos to sites.</div>
        </div>
        <div id="testResultsSummary" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnTestResultsCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnTestResultsConfirm" class="btn" type="button">Import Screenshots</button>
        </div>
      </div>
    </div>

    <div id="grantAccessModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Grant Project Access</h2>
          <button id="btnGrantAccessClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <label class="muted small">User email or ID</label>
          <input id="grantAccessUser" class="input" placeholder="user@example.com or UUID" autocomplete="off" />
          <label class="muted small">Role</label>
          <select id="grantAccessRole" class="input">
            <option value="USER_LEVEL_1">User Level 1</option>
            <option value="USER_LEVEL_2">User Level 2</option>
            <option value="PROJECT_MANAGER">Project Manager</option>
            <option value="ADMIN">Admin</option>
            <option value="OWNER">Owner</option>
            <option value="SUPPORT">Support</option>
          </select>
        </div>
        <div id="grantAccessNote" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnGrantAccessCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnGrantAccessConfirm" class="btn" type="button">Grant Access</button>
        </div>
      </div>
    </div>

    <div id="invoiceAgentModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="invoiceAgentTitle">Invoice Agent</h2>
          <button id="btnInvoiceAgentClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="row" style="margin-top:10px; justify-content:space-between; align-items:center;">
          <button id="btnInvoiceImport" class="btn ghost" type="button">Import Billing Spreadsheet</button>
          <input id="invoiceImportInput" type="file" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none;" />
          <button id="btnInvoiceImportExport" class="btn ghost small" type="button" style="display:none;">Export Preview CSV</button>
        </div>
        <div id="invoiceImportSummary" class="muted small" style="margin-top:6px;"></div>
        <div id="invoiceImportList" class="field-stack" style="margin-top:8px; max-height:200px; overflow:auto;"></div>
        <div class="field-stack" style="margin-top:10px;">
          <div>
            <div class="muted small" data-i18n="invoiceAgentFromLabel">From company</div>
            <select id="invoiceAgentFromOrg" class="input"></select>
          </div>
          <div>
            <div class="muted small" data-i18n="invoiceAgentToLabel">To company</div>
            <select id="invoiceAgentToOrg" class="input"></select>
          </div>
          <div id="invoiceAgentTierWrap" style="display:none;">
            <div class="muted small">Pricing tier</div>
            <select id="invoiceAgentTier" class="input">
              <option value="USER_LEVEL_1">User Level 1</option>
              <option value="USER_LEVEL_2">User Level 2</option>
              <option value="OWNER">Owner</option>
            </select>
          </div>
        </div>
        <div id="invoiceAgentSummary" class="muted small" style="margin-top:6px;"></div>
        <div class="row" style="margin-top:10px; justify-content:space-between; align-items:center;">
          <label class="row" style="gap:8px;">
            <input id="invoiceAgentSelectAll" type="checkbox" />
            <span data-i18n="invoiceAgentSelectAll">Select all eligible</span>
          </label>
          <label class="row" style="gap:8px;">
            <input id="invoiceAgentAllowDuplicates" type="checkbox" />
            <span data-i18n="invoiceAgentAllowDuplicates">Allow duplicates</span>
          </label>
        </div>
        <div id="invoiceAgentList" class="field-stack" style="margin-top:10px; max-height:260px; overflow:auto;"></div>
        <div id="invoiceAgentResults" class="note" style="display:none; margin-top:12px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnInvoiceAgentCancel" class="btn ghost" type="button" data-i18n="cancelLabel">Cancel</button>
          <button id="btnInvoiceImportApply" class="btn secondary" type="button" style="display:none;">Apply Import & Generate</button>
          <button id="btnInvoiceAgentConfirm" class="btn" type="button" data-i18n="invoiceAgentGenerate">Generate Drafts</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <div><b>SpecCom</b> -> by <b>Spec Communications, LLC</b></div>
      <div>A product of <b>Fatanett, LLC</b></div>
    </div>
  </div>

  <template id="spliceCodesTemplate">
    <div class="codes-section">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div class="codes-title" data-role="codes-title">Codes used</div>
        <div data-role="codes-actions"></div>
      </div>
      <div data-role="codes-body"></div>
      <div class="codes-title" data-role="desc-title">Brief description</div>
      <div data-role="desc-body"></div>
    </div>
  </template>

  <div id="toast" class="toast">
    <div id="toastTitle" class="title">Notice</div>
    <div id="toastBody" class="body"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="./env.generated.js"></script>
  <script type="module" src="./supabaseClient.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>

