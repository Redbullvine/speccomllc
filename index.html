<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SpecCom | Field Verification</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div>
          <div class="brand-title">SpecCom</div>
          <div class="muted small" data-i18n="brandSubtitle">Field verification, documentation, and billing control</div>
        </div>
      </div>
      <div class="row topbar-actions">
        <button id="btnMessages" class="topbar-btn" type="button" data-i18n="messagesNav">Messages
          <span id="messagesBadge" class="alert-badge" style="display:none;">0</span>
        </button>
        <button id="btnProjects" class="topbar-btn" type="button" data-i18n="projectsNav">Projects</button>
        <button id="btnMapToggle" class="topbar-btn" type="button" data-i18n="mapToggle" aria-pressed="true">Map</button>
        <button id="btnMenu" class="icon-btn" type="button" aria-label="Menu">
          <span class="hamburger">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
      </div>
    </div>
  </header>
  <div class="page container">
    <div class="spacer"></div>
    <div id="envWarning" class="note" style="display:none;"></div>
    <div id="storageWarning" class="note" style="display:none;"></div>

    <div id="viewAuth" class="stack">
      <div class="auth-wrap">
        <div class="card auth-card">
          <h1 data-i18n="authTitle">Sign in to SpecCom</h1>

          <div class="hr"></div>

          <form id="authForm" autocomplete="on">
            <div class="field-stack">
              <input id="email" class="input" placeholder="email" data-i18n-placeholder="emailPlaceholder" autocomplete="username" />
              <input id="password" class="input" placeholder="password" type="password" data-i18n-placeholder="passwordPlaceholder" autocomplete="current-password" />
            </div>
            <div class="row" style="margin-top:12px;">
              <button id="btnSignIn" class="btn" data-action="signIn" data-i18n="signIn" type="button">Sign in</button>
              <button id="btnSignUp" class="btn secondary" data-action="signUp" data-i18n="createUser" type="button">Create account</button>
              <button id="btnDemoLogin" class="btn ghost" data-action="demoLogin" data-i18n="demoLogin" type="button">Demo login</button>
            </div>
            <div class="row" style="margin-top:8px;">
              <button id="btnForgotPassword" class="btn ghost small" type="button">Forgot password?</button>
            </div>
          </form>
          <form id="resetForm" autocomplete="on" style="display:none;">
            <div class="field-stack">
              <input id="resetPassword" class="input" placeholder="New password" type="password" autocomplete="new-password" />
              <input id="resetPasswordConfirm" class="input" placeholder="Confirm password" type="password" autocomplete="new-password" />
            </div>
            <div class="row" style="margin-top:12px;">
              <button id="btnResetPassword" class="btn" type="button">Reset password</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="viewApp" class="app-shell" style="display:none;">
      <aside class="sidebar">
        <div id="currentProjectCard" class="card sidebar-card">
          <div class="muted small" data-i18n="currentProjectLabel">Current project</div>
          <div id="projectSummary" class="project-summary" data-i18n="projectSummaryNone">No project selected</div>
          <div id="projectMeta" class="muted small" style="margin-top:8px;"></div>
          <div class="row" style="margin-top:10px; justify-content:flex-end;">
            <button id="btnOpenProjects" class="btn small secondary" type="button" data-i18n="projectsNav">Projects</button>
          </div>
        </div>
        <div id="projectInfoCard" class="card" style="margin-top:12px;">
          <div class="muted small">Project info</div>
          <div id="projectInfoBody" class="project-info-body" style="margin-top:8px;"></div>
        </div>
        <div class="muted small" data-i18n="siteListTitle" style="margin-top:12px;">Sites</div>
        <div id="siteList" class="site-list" style="margin-top:8px;"></div>
      </aside>

      <main class="content">
        <section id="viewDashboard" class="view">
          <div class="card job-card">
            <div class="row" style="justify-content:space-between;">
              <div>
                <h2 id="jobTitle">Job 731022136</h2>
                <div id="jobSubtitle" class="muted small" data-i18n="jobSubtitle">Ruidoso FTTH Rebuild (site-by-site workflow)</div>
              </div>
              <div class="no-pay-badge" data-i18n="photosOptionalBadge">Photos optional for MVP</div>
            </div>
            <div id="nodeCards" class="node-grid" style="margin-top:12px;"></div>
          </div>
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="activeNodeTitle">Active site</h2>
              <div class="kpi">
                <div class="tile">
                  <div class="label" data-i18n="kpiNode">Site</div>
                  <div id="dashNode" class="value">None</div>
                </div>
                <div class="tile">
                  <div class="label" data-i18n="kpiCompletion">Completion</div>
                  <div id="dashCompletion" class="value">0%</div>
                </div>
                <div class="tile">
                  <div class="label" data-i18n="kpiUnits">Units</div>
                  <div id="dashUnits" class="value">0 / 0</div>
                </div>
              </div>
              <div style="margin-top:14px;" class="row">
                <span id="chipStatus" class="chip"><span class="dot warn"></span><span>Waiting</span></span>
                <span id="chipRole" class="chip"><span class="dot ok"></span><span>Role: ?</span></span>
                <span id="chipPricing" class="chip"><span class="dot bad"></span><span data-i18n="pricingHidden">Pricing hidden from splicers</span></span>
                <span id="chipBuildMode" class="chip" style="display:none;"><span class="dot warn"></span><span>BUILD MODE (restrictions disabled)</span></span>
              </div>
              <div class="hr"></div>
              <div id="photoChecklistSummary" class="note"></div>
            </div>
            <div class="card">
              <h2 data-i18n="alertsTitle">Alerts</h2>
              <div id="alertsFeed"></div>
            </div>
          </div>
          <div class="grid cols-2" style="margin-top:16px;">
            <div class="card">
              <h2 data-i18n="allowedQuantitiesTitle">Allowed quantities</h2>
              <div id="allowedQuantities"></div>
            </div>
            <div class="card">
              <h2 data-i18n="catalogQuickSearchTitle">Catalog quick search</h2>
              <input id="catalogSearchQuick" class="input" placeholder="Search Millennium part, MFG SKU, description" data-i18n-placeholder="catalogSearchPlaceholder" />
              <div id="catalogResultsQuick" class="catalog-list" style="margin-top:12px;"></div>
            </div>
          </div>
        </section>

        <section id="viewTechnician" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="techClockTitle">Time tracking</h2>
              <div id="techClockStatus" class="muted small" style="margin-top:6px;"></div>
              <div class="row" style="margin-top:12px;">
                <button id="btnTechClockIn" class="btn" data-action="techClockIn" data-i18n="techClockIn">Clock In</button>
                <button id="btnTechClockOut" class="btn secondary" data-action="techClockOut" data-i18n="techClockOut">Clock Out</button>
              </div>
              <div class="hr"></div>
              <div class="muted small" data-i18n="techJobStateLabel">Current state</div>
              <div id="techJobState" class="chip" style="margin-top:8px;"></div>
              <div class="row" style="flex-wrap:wrap; margin-top:12px;">
                <button id="btnTechStartJob" class="btn" data-action="techStartJob" data-i18n="techStartJob">Start Job</button>
                <button id="btnTechPauseJob" class="btn secondary" data-action="techPauseJob" data-i18n="techPauseJob">Pause Job</button>
                <button id="btnTechLunch" class="btn ghost" data-action="techLunch" data-i18n="techLunch">Lunch</button>
                <button id="btnTechBreak" class="btn ghost" data-action="techBreak" data-i18n="techBreak">Break</button>
                <button id="btnTechTruckInspection" class="btn ghost" data-action="techTruckInspection" data-i18n="techTruckInspection">Truck Inspection</button>
                <button id="btnTechEndJob" class="btn danger" data-action="techEndJob" data-i18n="techEndJob">End Job</button>
              </div>
              <div class="hr"></div>
              <div id="techEventLog" class="tech-log"></div>
            </div>
            <div class="card">
              <h2 data-i18n="techSummaryTitle">Daily summary</h2>
              <div id="techSummary" style="margin-top:12px;"></div>
              <div class="hr"></div>
              <h3 data-i18n="techLocationTrailTitle">Location trail</h3>
              <div id="techLocationTrail" class="muted small" style="margin-top:8px;"></div>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="techWorkOrdersTitle">Work orders</h2>
              <div class="muted small" data-i18n="techWorkOrdersSubtitle">Assigned installs and trouble tickets</div>
            </div>
            <div class="grid cols-2" style="margin-top:12px;">
              <div>
                <h3 data-i18n="techTodayTitle">Today</h3>
                <div id="techWorkOrdersToday" style="margin-top:10px;"></div>
              </div>
              <div>
                <h3 data-i18n="techTomorrowTitle">Tomorrow</h3>
                <div id="techWorkOrdersTomorrow" style="margin-top:10px;"></div>
              </div>
            </div>
          </div>
        </section>

        <section id="viewNodes" class="view">
          <div class="card">
            <h1 data-i18n="nodesTitle">Site workspace</h1>
            <div class="muted small" data-i18n="nodesSubtitle">Only one ACTIVE site at a time. Finish splicing before moving to the next site.</div>

            <div class="row" style="margin-bottom:12px;">
              <input id="nodeNumber" class="input" placeholder="Enter site number (example: SITE-1001)" data-i18n-placeholder="nodeNumberPlaceholder" />
              <button id="btnOpenNode" class="btn" data-action="openNodeInput" data-i18n="openNode">Open site</button>
              <button id="btnNewNode" class="btn secondary" data-action="createNodeInput" data-i18n="createNode">Create site</button>
            </div>

            <div class="hr"></div>

            <h2 data-i18n="spliceLocationsTitle">Splice locations</h2>
            <p class="muted small" data-i18n="spliceLocationsSubtitle">Photos are optional for billing in this MVP.</p>

            <div class="row">
              <button id="btnAddLocation" class="btn secondary" data-action="addSpliceLocation" data-i18n="addSpliceLocation">Add splice location</button>
            </div>

            <div id="locations" style="margin-top:12px;"></div>

            <div class="hr"></div>

            <h2 data-i18n="inventoryTitle">Inventory checklist</h2>
            <p class="muted small" data-i18n="inventorySubtitle">What was used at this site. Splicers see items and checklists, not pricing.</p>
            <div id="inventory" style="margin-top:12px;"></div>
          </div>
        </section>



        <section id="viewPhotos" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="photoChecklistTitle">Photo checklist</h2>
              <div class="no-pay-banner" data-i18n="photosOptionalBanner">Photos optional for MVP</div>
              <div id="photoChecklist"></div>
            </div>
            <div class="card">
              <h2 data-i18n="capturePhotosTitle">Capture photos</h2>
              <div class="muted small" data-i18n="capturePhotosSubtitle">Camera-only. GPS required at capture time. No gallery uploads.</div>
              <div class="camera-panel">
                <video id="cameraStream" autoplay playsinline muted></video>
              </div>
              <div class="row" style="margin-top:12px;">
                <button id="btnStartCamera" class="btn secondary" data-action="startCamera" data-i18n="startCamera">Start camera</button>
                <button id="btnCapturePhoto" class="btn secondary" data-action="captureUsagePhoto" data-i18n="captureUsagePhoto">Capture usage photo</button>
              </div>
              <div id="photoStatus" class="muted small" style="margin-top:10px;" data-i18n="photoStatusNone">No photo captured</div>
              <div id="photoPreview" class="photo-preview" style="margin-top:12px;"></div>
              <div class="hr"></div>
              <div id="backfillPanel" class="note backfill-panel" style="display:none;">
                <div style="font-weight:900;">Owner backfill</div>
                <div class="muted small">Upload from device when backfill is enabled for this site.</div>
                <div class="row" style="flex-wrap:wrap; margin-top:8px;">
                  <select id="backfillLocationSelect" class="input" style="min-width:220px; flex:1 1 auto;"></select>
                </div>
                <div class="row" style="flex-wrap:wrap; margin-top:8px;">
                  <label class="btn ghost file-btn">
                    Upload from device (Port test)
                    <input id="backfillPortInput" type="file" accept="image/*" />
                  </label>
                  <label class="btn ghost file-btn">
                    Upload from device (Splice complete)
                    <input id="backfillSpliceInput" type="file" accept="image/*" />
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
        <section id="viewInvoices" class="view">
          <div class="grid cols-2">
            <div class="card">
              <h2 data-i18n="invoiceActionsTitle">Invoice actions</h2>
              <div class="no-pay-banner" data-i18n="invoicesUngatedBanner">Invoices available without proof in MVP</div>
              <div class="muted small" data-i18n="invoiceActionsSubtitle">Billing entry is available in this MVP.</div>
              <div class="row" style="margin-top:12px;">
                <button id="btnMarkNodeReady" class="btn" data-action="markNodeReady" data-i18n="markNodeReady">Mark site READY for billing</button>
                <button id="btnCreateInvoice" class="btn secondary" data-action="createInvoice" data-i18n="createInvoice">Create invoice (role-based)</button>
              </div>
              <div id="readyNote" class="note" style="margin-top:12px; display:none;"></div>
            </div>
            <div class="card">
              <h2 data-i18n="invoicesPrivacyTitle">Invoices and privacy</h2>
              <div class="muted small">
                This panel shows what <b>you</b> can see based on your role.
                In Supabase, RLS policies enforce this server-side.
              </div>

              <div class="hr"></div>
              <div id="invoicePanel"></div>
            </div>
          </div>
        </section>

        <section id="viewBilling" class="view">
          <div class="grid cols-2">
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2 data-i18n="billingLocationsTitle">Locations</h2>
                <span id="billingStatus" class="muted small"></span>
              </div>
              <div id="billingLocationList" class="location-list" style="margin-top:12px;"></div>
            </div>
            <div class="card">
              <div class="row" style="justify-content:space-between;">
                <h2 data-i18n="billingTitle">Billing</h2>
                <div class="row">
                  <button id="btnImportUsage" class="btn ghost" data-action="importUsage" data-i18n="importUsage">Import usage</button>
                  <button id="btnBillingExportCsv" class="btn ghost" data-action="billingExportCsv" data-i18n="exportCsv">Export CSV</button>
                  <button id="btnBillingPrint" class="btn ghost" data-action="billingPrint" data-i18n="print">Print</button>
                </div>
              </div>
              <div id="billingDetail" class="muted small" style="margin-top:12px;" data-i18n="billingSelectLocation">Select a location to start billing.</div>
            </div>
          </div>
        </section>

        <section id="viewDispatch" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between; align-items:center;">
              <h2 data-i18n="dispatchTitle">Dispatch</h2>
              <div class="row" style="flex-wrap:wrap;">
                <button id="btnDispatchCreate" class="btn" data-action="dispatchCreate" data-i18n="dispatchCreate">Create work order</button>
                <button id="btnDispatchImportCsv" class="btn ghost" data-action="dispatchImportCsv" data-i18n="dispatchImportCsv">Import CSV</button>
                <input id="dispatchCsvInput" type="file" accept=".csv,text/csv" style="display:none;" />
              </div>
            </div>
            <div class="row" style="flex-wrap:wrap; margin-top:12px;">
              <input id="dispatchDateFilter" class="input" type="date" />
              <select id="dispatchStatusFilter" class="input">
                <option value="" data-i18n="dispatchStatusAll">All statuses</option>
              </select>
              <select id="dispatchAssignFilter" class="input">
                <option value="all" data-i18n="dispatchAssignAll">All</option>
                <option value="assigned" data-i18n="dispatchAssignAssigned">Assigned</option>
                <option value="unassigned" data-i18n="dispatchAssignUnassigned">Unassigned</option>
              </select>
            </div>
            <div id="dispatchImportWarnings" class="note warning" style="display:none; margin-top:12px;"></div>
            <div id="dispatchTable" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewLabor" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="laborTitle">Labor</h2>
              <button id="btnLaborExportCsv" class="btn ghost" data-action="laborExportCsv" data-i18n="exportCsv">Export CSV</button>
            </div>
            <div id="laborTable" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewMap" class="view active">
          <div class="card">
            <div class="row" style="justify-content:space-between; align-items:center;">
              <div>
                <h1 data-i18n="mapTitle">Sites map</h1>
                <div class="muted small" data-i18n="mapSubtitle">Drop a pin to create a site and add documentation.</div>
              </div>
              <div class="row map-controls">
                <input id="dropPinName" class="input compact" placeholder="Site name" data-i18n-placeholder="dropPinNamePlaceholder" />
                <button id="btnDropPin" class="btn" data-action="dropPin" data-i18n="dropPin">Drop Pin</button>
                <button id="btnImportLocations" class="btn secondary" type="button" data-i18n="importLocations">Import Locations (Excel/CSV)</button>
                <button id="btnInvoiceAgent" class="btn secondary" type="button" data-i18n="invoiceAgentAction">Invoice Agent</button>
                <input id="importLocationsInput" type="file" accept=".csv,.xlsx,.pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,application/pdf" style="display:none;" />
              </div>
            </div>
            <div id="mapLayout" class="map-layout">
              <div id="mapShell" class="map-shell">
                <div class="map-sheet-bar">
                  <button id="mapSheetHandle" class="map-sheet-handle" type="button" aria-label="Resize map"></button>
                  <div class="map-sheet-snaps" role="group" aria-label="Map size">
                    <button class="map-snap-btn" type="button" data-map-snap="30">30%</button>
                    <button class="map-snap-btn" type="button" data-map-snap="60">60%</button>
                    <button class="map-snap-btn" type="button" data-map-snap="90">90%</button>
                  </div>
                </div>
                <div id="liveMap" class="map"></div>
                <div id="mapStatus" class="muted small" style="margin-top:10px;"></div>
              </div>
              <div class="site-panel-shell">
                <div class="site-panel-card">
                  <div class="row" style="justify-content:space-between; align-items:center;">
                    <div>
                      <div class="site-panel-title" data-i18n="sitePanelTitle">Site panel</div>
                      <div id="sitePanelSubtitle" class="muted small" data-i18n="noSiteSelected">No site selected.</div>
                    </div>
                    <button id="btnCloseSitePanel" class="btn ghost small" data-action="closeSitePanel" data-i18n="closeLabel">Close</button>
                  </div>
                  <div class="hr"></div>

                  <div class="panel-section">
                    <div class="section-title" data-i18n="siteNameTitle">Location name</div>
                    <div class="muted small" data-i18n="siteNameSubtitle">Name this splice location so it is easy to find later.</div>
                    <div class="row" style="margin-top:8px;">
                      <input id="siteNameInput" class="input" placeholder="Location name" data-i18n-placeholder="siteNamePlaceholder" />
                      <button id="btnSaveSiteName" class="btn secondary" data-action="saveSiteName" data-i18n="saveLabel">Save</button>
                      <button id="btnEditSiteLocation" class="btn ghost" type="button">Edit location</button>
                    </div>
                  </div>

                  <div class="panel-section">
                    <div class="section-title" data-i18n="mediaTitle">Media</div>
                    <div class="muted small" data-i18n="mediaSubtitle">Add images from camera or gallery.</div>
                    <div class="row" style="margin-top:8px;">
                      <label class="btn secondary file-btn">
                        <span data-i18n="addMedia">Add media</span>
                        <input id="siteMediaInput" type="file" accept="image/*" capture="environment" />
                      </label>
                    </div>
                    <div id="siteMediaGallery" class="media-gallery" style="margin-top:10px;"></div>
                  </div>

                  <div class="panel-section">
                    <div class="section-title" data-i18n="codesTitle">Codes</div>
                    <div class="muted small" data-i18n="codesSubtitle">Add one or more codes for this site.</div>
                    <div class="row" style="margin-top:8px;">
                      <input id="siteCodesInput" class="input" placeholder="Add codes (comma separated)" data-i18n-placeholder="codesPlaceholder" />
                      <button id="btnSaveCodes" class="btn secondary" data-action="saveCodes" data-i18n="saveLabel">Save</button>
                    </div>
                    <div id="siteCodesList" class="code-list" style="margin-top:8px;"></div>
                  </div>

                  <div class="panel-section">
                    <div class="section-title" data-i18n="entriesTitle">Entries</div>
                    <div class="muted small" data-i18n="entriesSubtitle">Add neutral line entries with optional quantity.</div>
                    <div class="row" style="margin-top:8px;">
                      <input id="siteEntryDescription" class="input" placeholder="Entry description" data-i18n-placeholder="entryDescriptionPlaceholder" />
                      <input id="siteEntryQuantity" class="input" type="number" step="0.01" placeholder="Qty (optional)" data-i18n-placeholder="entryQuantityPlaceholder" />
                      <button id="btnAddEntry" class="btn secondary" data-action="addEntry" data-i18n="addEntry">Add</button>
                    </div>
                    <div id="siteEntriesList" class="entry-list" style="margin-top:8px;"></div>
                  </div>

                  <div class="panel-section">
                    <div class="section-title" data-i18n="notesTitle">Notes</div>
                    <div class="muted small" data-i18n="notesSubtitle">Optional notes for this site.</div>
                    <textarea id="siteNotesInput" class="input" rows="3" placeholder="Add notes" data-i18n-placeholder="notesPlaceholder"></textarea>
                    <div class="row" style="margin-top:8px;">
                      <button id="btnSaveNotes" class="btn secondary" data-action="saveNotes" data-i18n="saveLabel">Save</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="viewCatalog" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="catalogTitle">Material catalog</h2>
              <button id="btnCatalogClear" class="btn ghost" data-action="catalogClear" data-i18n="clear">Clear</button>
            </div>
            <div class="row" style="margin-top:12px;">
              <input id="catalogSearch" class="input" placeholder="Search Millennium part, MFG SKU, description" data-i18n-placeholder="catalogSearchPlaceholder" />
            </div>
            <div id="catalogResults" class="catalog-list" style="margin-top:16px;"></div>
          </div>
        </section>

        <section id="viewAlerts" class="view">
          <div class="card">
            <div class="row" style="justify-content:space-between;">
              <h2 data-i18n="alertsFeedTitle">Alerts feed</h2>
              <span id="alertsBadge" class="badge">No alerts</span>
            </div>
            <div id="alertsFeedFull" style="margin-top:12px;"></div>
          </div>
        </section>

        <section id="viewAdmin" class="view">
          <div class="card">
            <h2 data-i18n="adminNotesTitle">Admin notes</h2>
            <div class="note">
              <div style="font-weight:900;">Next build steps</div>
              <ol class="muted small" style="margin-top:8px;">
                <li>Wire Supabase keys in Netlify env vars.</li>
                <li>Run the SQL schema + RLS in Supabase.</li>
                <li>Enable Storage bucket for photos (private).</li>
                <li>Add real site sheets import and Millennium part lookup.</li>
              </ol>
            </div>
          </div>
          <div class="card" style="margin-top:12px;">
            <h2 data-i18n="userManagementTitle">User management</h2>
            <div class="muted small" data-i18n="userManagementSubtitle">Create/update profile rows for authenticated users. Auth users must already exist in Supabase.</div>
            <div id="adminBuildGate" class="note warning" style="display:none; margin-top:10px;">
              <div style="font-weight:900;">Build mode disabled</div>
              <div class="muted small">Enable BUILD_MODE to manage user profiles.</div>
            </div>
            <div id="adminUsersPanel" style="margin-top:12px;">
              <div class="row" style="flex-wrap:wrap;">
                <input id="adminUserId" class="input" placeholder="Auth user id (UUID)" data-i18n-placeholder="adminUserIdPlaceholder" />
                <input id="adminUserEmail" class="input" placeholder="Email or display name" data-i18n-placeholder="adminUserEmailPlaceholder" />
                <select id="adminUserRole" class="input" style="min-width:180px;">
                  <option value="OWNER">Owner</option>
                  <option value="ADMIN">Admin</option>
                  <option value="PROJECT_MANAGER">Project Manager</option>
                  <option value="USER_LEVEL_1">User Level 1</option>
                  <option value="USER_LEVEL_2">User Level 2</option>
                  <option value="SUPPORT">Support</option>
                </select>
                <button id="btnAdminCreateUser" class="btn secondary" data-action="adminCreateUser" data-i18n="createProfile">Create profile</button>
              </div>
              <div class="hr"></div>
              <div id="adminUsersList"></div>
            </div>
          </div>
        </section>

        <section id="viewSettings" class="view">
          <div class="card">
            <h1 data-i18n="settingsTitle">Settings</h1>
            <div class="field-stack">
              <label class="muted small" data-i18n="languageLabel">Language</label>
              <select id="languageSelect" class="input">
                <option value="en" data-i18n="languageOptionEnglish">English</option>
                <option value="es" data-i18n="languageOptionSpanish">Spanish</option>
              </select>
              <div class="muted small" data-i18n="languageHelp">Changes apply immediately and sync to your profile.</div>
              <div class="row">
                <button id="btnSaveLanguage" class="btn secondary" data-action="saveLanguage" data-i18n="saveLanguage">Save language</button>
              </div>
            </div>
          </div>
        </section>
        <section id="viewDailyReport" class="view">
          <div class="card">
            <h1 data-i18n="dailyReportTitle">Daily Report</h1>
            <div class="field-stack">
              <label class="muted small" data-i18n="dprProjectLabel">Project</label>
              <select id="dprProjectSelect" class="input">
                <option value="" data-i18n="selectProject">Select project</option>
              </select>
              <label class="muted small" data-i18n="dprDateLabel">Report date</label>
              <input id="dprDate" class="input" type="date" />
              <div class="row">
                <button id="btnDprRefresh" class="btn secondary" type="button" data-i18n="dprRefresh">Generate / Refresh</button>
              </div>
              <div id="dprMetrics" class="dpr-metrics"></div>
              <label class="muted small" data-i18n="dprCommentsLabel">Comments / Needs Addressed</label>
              <textarea id="dprComments" class="input" rows="4" data-i18n-placeholder="dprCommentsPlaceholder" placeholder="Anything needs addressed?"></textarea>
              <div class="row">
                <button id="btnDprSave" class="btn" type="button" data-i18n="saveLabel">Save</button>
              </div>
              <div id="dprNote" class="muted small"></div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="profileSetupModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Choose Language / Elegir idioma</h2>
        <div class="muted small">Select your preferred language to continue.</div>
        <div class="field-stack" style="margin-top:12px;">
          <select id="profileLanguageSelect" class="input">
            <option value="en">English</option>
            <option value="es">Español</option>
          </select>
          <button id="btnSaveProfileLanguage" class="btn" data-action="saveProfileLanguage">Save / Guardar</button>
        </div>
      </div>
    </div>

    <div id="createProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Create project</h2>
        <form id="createProjectForm" autocomplete="off">
          <div class="field-stack" style="margin-top:12px;">
            <input id="createProjectName" name="project_name" class="input" placeholder="Project name" autocomplete="off" />
            <textarea id="createProjectDescription" name="project_description" class="input" rows="3" placeholder="Description (optional)" autocomplete="off"></textarea>
          </div>
          <div class="row" style="margin-top:12px; justify-content:flex-end;">
            <button id="btnCreateProjectCancel" class="btn ghost" type="button">Cancel</button>
            <button id="btnCreateProjectSave" class="btn" type="button">Create</button>
          </div>
        </form>
      </div>
    </div>

    <div id="deleteProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <h2>Delete project</h2>
        <div class="muted small">Type DELETE to confirm. This permanently removes project data.</div>
        <div class="field-stack" style="margin-top:12px;">
          <input id="deleteProjectConfirm" class="input" placeholder="Type DELETE to confirm" autocomplete="off" />
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnDeleteProjectCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnDeleteProjectConfirm" class="btn danger" type="button">Delete project</button>
        </div>
      </div>
    </div>

    <div id="projectsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="projectsNav">Projects</h2>
          <button id="btnProjectsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="projectsList" class="project-list" style="margin-top:10px;"></div>
        <div id="projectsEmpty" class="empty-state" style="display:none; margin-top:10px;">
          <div class="empty-state-title" data-i18n="projectsEmptyTitle">No projects yet</div>
          <div class="empty-state-body muted small" data-i18n="projectsEmptyBody">Create a project to start tracking sites and documentation, or ask your admin to add you to an existing project.</div>
          <div class="row" style="margin-top:12px; justify-content:flex-end;">
            <button id="btnProjectsEmptyCreate" class="btn" type="button" data-i18n="projectsEmptyCta">Create project</button>
          </div>
        </div>
        <div id="projectsFooter" class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnProjectsCreate" class="btn" type="button" data-i18n="createProject">Create project</button>
        </div>
      </div>
    </div>

    <div id="messagesModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="messagesNav">Messages</h2>
          <button id="btnMessagesClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="messagesScope" class="muted small" style="margin-top:4px;"></div>
        <div id="messagesList" class="messages-list" style="margin-top:10px;"></div>
        <div id="messagesEmpty" class="muted small" style="margin-top:10px; display:none;" data-i18n="messagesEmpty">No messages yet.</div>
        <div class="field-stack" style="margin-top:12px;">
          <textarea id="messageInput" class="input" rows="3" data-i18n-placeholder="messagePlaceholder" placeholder="Write a message..."></textarea>
          <div class="row" style="justify-content:flex-end;">
            <button id="btnSendMessage" class="btn" type="button" data-i18n="sendMessage">Send</button>
          </div>
        </div>
      </div>
    </div>

    <div id="menuModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="menuTitle">Menu</h2>
          <button id="btnMenuClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="menu-section">
          <div class="menu-title" data-i18n="menuNavTitle">Navigation</div>
          <button class="menu-link" type="button" data-view="viewDailyReport" data-i18n="dailyReportTitle">Daily Report</button>
          <button id="btnGrantProjectAccess" class="menu-link" type="button" style="display:none;">Grant Project Access</button>
          <button id="btnImportPriceSheet" class="menu-link" type="button" style="display:none;">Import Price Sheet</button>
          <button id="btnCreateProjectFromStaking" class="menu-link" type="button" style="display:none;">Create Project from Staking PDF</button>
          <button id="btnImportTestResults" class="menu-link" type="button" style="display:none;">Import Test Results (ZIP)</button>
        </div>
        <div class="menu-section">
          <div class="menu-title" data-i18n="menuSettingsTitle">Settings</div>
          <div class="segmented">
            <button class="segmented-btn" type="button" data-lang="en" data-i18n="languageOptionEnglish">English</button>
            <button class="segmented-btn" type="button" data-lang="es" data-i18n="languageOptionSpanish">Spanish</button>
          </div>
        </div>
        <div class="menu-section">
          <div class="menu-title" data-i18n="menuAboutTitle">About</div>
          <p class="muted small" id="aboutCopy" data-i18n="aboutCopy">SpecCom turns field chaos into a single, intelligent workflow -- accelerating documentation, tightening project coordination, and protecting margins with fewer surprises. The result is less rework, clearer accountability, and faster paths from job done to money in.</p>
        </div>
        <div class="menu-footer">
          <button id="btnSignOut" class="btn secondary" type="button" style="display:none;" data-action="signOut" data-i18n="signOut">Sign out</button>
        </div>
      </div>
    </div>

    <div id="dispatchModal" class="modal" style="display:none;">
      <div class="card modal-card" style="max-width:720px;">
        <h2 data-i18n="dispatchModalTitle">Work order</h2>
        <div class="field-stack" style="margin-top:12px;">
          <select id="dispatchType" class="input">
            <option value="INSTALL">INSTALL</option>
            <option value="TROUBLE_TICKET">TROUBLE_TICKET</option>
            <option value="MAINTENANCE">MAINTENANCE</option>
            <option value="SURVEY">SURVEY</option>
          </select>
          <select id="dispatchStatus" class="input">
            <option value="NEW">NEW</option>
            <option value="ASSIGNED">ASSIGNED</option>
            <option value="EN_ROUTE">EN_ROUTE</option>
            <option value="ON_SITE">ON_SITE</option>
            <option value="IN_PROGRESS">IN_PROGRESS</option>
            <option value="BLOCKED">BLOCKED</option>
            <option value="COMPLETE">COMPLETE</option>
            <option value="CANCELED">CANCELED</option>
          </select>
          <input id="dispatchScheduledStart" class="input" type="datetime-local" />
          <input id="dispatchScheduledEnd" class="input" type="datetime-local" />
          <input id="dispatchCustomerLabel" class="input" placeholder="Customer name" />
          <input id="dispatchAddress" class="input" placeholder="Address" />
          <div class="row">
            <input id="dispatchLat" class="input" placeholder="Lat" />
            <input id="dispatchLng" class="input" placeholder="Lng" />
          </div>
          <input id="dispatchContactPhone" class="input" placeholder="Contact phone" />
          <input id="dispatchPriority" class="input" type="number" min="1" max="5" placeholder="Priority (1-5)" />
          <input id="dispatchSlaDueAt" class="input" type="datetime-local" />
          <textarea id="dispatchNotes" class="input" rows="3" placeholder="Notes"></textarea>
          <select id="dispatchAssignUser" class="input">
            <option value="">Unassigned</option>
          </select>
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnDispatchCancel" class="btn ghost" data-action="dispatchCancel" data-i18n="cancelLabel">Cancel</button>
          <button id="btnDispatchSave" class="btn" data-action="dispatchSave" data-i18n="saveLabel">Save</button>
        </div>
      </div>
    </div>

    <div id="importLocationsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import locations</h2>
          <button id="btnImportLocationsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div id="importLocationsSummary" class="muted small" style="margin-top:6px;"></div>
        <div id="importLocationsList" class="field-stack" style="margin-top:10px; max-height:240px; overflow:auto;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnImportLocationsCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnImportLocationsConfirm" class="btn" type="button">Confirm Import</button>
        </div>
      </div>
    </div>

    <div id="priceSheetModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import Price Sheet</h2>
          <button id="btnPriceSheetClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="priceSheetInput" type="file" accept=".csv,.xlsx,.pdf,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,application/pdf" />
          <div class="muted small">Expected headers: code, description, unit, rate</div>
          <div class="muted small">USER2 = USER1 +25% • OWNER = USER2 +25%</div>
        </div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnPriceSheetCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnPriceSheetConfirm" class="btn" type="button">Import Pricing</button>
        </div>
      </div>
    </div>

    <div id="stakingProjectModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Create Project from Staking PDF</h2>
          <button id="btnStakingProjectClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="stakingProjectInput" type="file" accept=".pdf,application/pdf" />
          <div class="muted small">Uploads a staking package PDF and builds a project + placeholder sites.</div>
          <div class="hr" style="margin:8px 0;"></div>
          <input id="stakingLocationsInput" type="file" accept=".csv,.xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel" />
          <div class="muted small">Optional: upload a location spreadsheet to set accurate GPS and merge by location name.</div>
        </div>
        <div id="stakingProjectSummary" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnStakingProjectCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnStakingProjectConfirm" class="btn" type="button">Create Project</button>
        </div>
      </div>
    </div>

    <div id="testResultsModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Import Test Results (ZIP)</h2>
          <button id="btnTestResultsClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <input id="testResultsInput" type="file" accept=".zip,application/zip" />
          <div class="muted small">Reads screenshot text to match GPS/location and attach photos to sites.</div>
        </div>
        <div id="testResultsSummary" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnTestResultsCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnTestResultsConfirm" class="btn" type="button">Import Screenshots</button>
        </div>
      </div>
    </div>

    <div id="grantAccessModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2>Grant Project Access</h2>
          <button id="btnGrantAccessClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="field-stack" style="margin-top:10px;">
          <label class="muted small">User email or ID</label>
          <input id="grantAccessUser" class="input" placeholder="user@example.com or UUID" autocomplete="off" />
          <label class="muted small">Role</label>
          <select id="grantAccessRole" class="input">
            <option value="USER_LEVEL_1">User Level 1</option>
            <option value="USER_LEVEL_2">User Level 2</option>
            <option value="PROJECT_MANAGER">Project Manager</option>
            <option value="ADMIN">Admin</option>
            <option value="OWNER">Owner</option>
            <option value="SUPPORT">Support</option>
          </select>
        </div>
        <div id="grantAccessNote" class="muted small" style="margin-top:10px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnGrantAccessCancel" class="btn ghost" type="button">Cancel</button>
          <button id="btnGrantAccessConfirm" class="btn" type="button">Grant Access</button>
        </div>
      </div>
    </div>

    <div id="invoiceAgentModal" class="modal" style="display:none;">
      <div class="card modal-card">
        <div class="modal-header">
          <h2 data-i18n="invoiceAgentTitle">Invoice Agent</h2>
          <button id="btnInvoiceAgentClose" class="btn ghost small" type="button" data-i18n="closeLabel">Close</button>
        </div>
        <div class="row" style="margin-top:10px; justify-content:space-between; align-items:center;">
          <button id="btnInvoiceImport" class="btn ghost" type="button">Import Billing Spreadsheet</button>
          <input id="invoiceImportInput" type="file" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none;" />
          <button id="btnInvoiceImportExport" class="btn ghost small" type="button" style="display:none;">Export Preview CSV</button>
        </div>
        <div id="invoiceImportSummary" class="muted small" style="margin-top:6px;"></div>
        <div id="invoiceImportList" class="field-stack" style="margin-top:8px; max-height:200px; overflow:auto;"></div>
        <div class="field-stack" style="margin-top:10px;">
          <div>
            <div class="muted small" data-i18n="invoiceAgentFromLabel">From company</div>
            <select id="invoiceAgentFromOrg" class="input"></select>
          </div>
          <div>
            <div class="muted small" data-i18n="invoiceAgentToLabel">To company</div>
            <select id="invoiceAgentToOrg" class="input"></select>
          </div>
          <div id="invoiceAgentTierWrap" style="display:none;">
            <div class="muted small">Pricing tier</div>
            <select id="invoiceAgentTier" class="input">
              <option value="USER_LEVEL_1">User Level 1</option>
              <option value="USER_LEVEL_2">User Level 2</option>
              <option value="OWNER">Owner</option>
            </select>
          </div>
        </div>
        <div id="invoiceAgentSummary" class="muted small" style="margin-top:6px;"></div>
        <div class="row" style="margin-top:10px; justify-content:space-between; align-items:center;">
          <label class="row" style="gap:8px;">
            <input id="invoiceAgentSelectAll" type="checkbox" />
            <span data-i18n="invoiceAgentSelectAll">Select all eligible</span>
          </label>
          <label class="row" style="gap:8px;">
            <input id="invoiceAgentAllowDuplicates" type="checkbox" />
            <span data-i18n="invoiceAgentAllowDuplicates">Allow duplicates</span>
          </label>
        </div>
        <div id="invoiceAgentList" class="field-stack" style="margin-top:10px; max-height:260px; overflow:auto;"></div>
        <div id="invoiceAgentResults" class="note" style="display:none; margin-top:12px;"></div>
        <div class="row" style="margin-top:12px; justify-content:flex-end;">
          <button id="btnInvoiceAgentCancel" class="btn ghost" type="button" data-i18n="cancelLabel">Cancel</button>
          <button id="btnInvoiceImportApply" class="btn secondary" type="button" style="display:none;">Apply Import & Generate</button>
          <button id="btnInvoiceAgentConfirm" class="btn" type="button" data-i18n="invoiceAgentGenerate">Generate Drafts</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <div><b>SpecCom</b> -> by <b>Spec Communications, LLC</b></div>
      <div>A product of <b>Fatanett, LLC</b></div>
    </div>
  </div>

  <template id="spliceCodesTemplate">
    <div class="codes-section">
      <div class="row" style="justify-content:space-between; align-items:center;">
        <div class="codes-title" data-role="codes-title">Codes used</div>
        <div data-role="codes-actions"></div>
      </div>
      <div data-role="codes-body"></div>
      <div class="codes-title" data-role="desc-title">Brief description</div>
      <div data-role="desc-body"></div>
    </div>
  </template>

  <div id="toast" class="toast">
    <div id="toastTitle" class="title">Notice</div>
    <div id="toastBody" class="body"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="./env.generated.js"></script>
  <script type="module" src="./supabaseClient.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
